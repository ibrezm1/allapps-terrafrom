# Remove anything which may clash with Docker
apt-get remove -y docker docker-engine docker.io containerd runc
apt-get update

# Add dependant libraries
apt-get install -y apt-transport-https ca-certificates curl software-properties-common wget htop


apt update
apt install --yes apt-transport-https ca-certificates curl gnupg2 software-properties-common
curl -fsSL https://download.docker.com/linux/debian/gpg | sudo apt-key add -
add-apt-repository "deb [arch=amd64] https://download.docker.com/linux/debian $(lsb_release -cs) stable"
wget -q -O - https://packages.cloudfoundry.org/debian/cli.cloudfoundry.org.key | sudo apt-key add -
echo "deb https://packages.cloudfoundry.org/debian stable main" | sudo tee /etc/apt/sources.list.d/cloudfoundry-cli.list

sudo apt-get update
apt update
apt install --yes docker-ce
sudo apt-get install cf-cli

# Download Docker Compose, move it to usr bin and make executable
curl -L "https://github.com/docker/compose/releases/download/1.23.2/docker-compose-$(uname -s)-$(uname -m)" -o /usr/local/bin/docker-compose
chmod +x /usr/local/bin/docker-compose
docker-compose --version

sudo usermod -aG docker ibrezm1 
sudo usermod -aG docker Ibrez 


# https://sensu.io/blog/minikube-tutorial

grep -E --color 'vmx|svm' /proc/cpuinfo 
cd /tmp 



# Fly login, create target main and display targets
exec sudo -u Ibrez /bin/sh - << eof
curl -LO https://storage.googleapis.com/kubernetes-release/release/$(curl -s https://storage.googleapis.com/kubernetes-release/release/stable.txt)/bin/linux/amd64/kubectl
chmod +x ./kubectl
sudo mv ./kubectl /usr/local/bin/kubectl
curl -Lo minikube https://storage.googleapis.com/minikube/releases/latest/minikube-linux-amd64 
chmod +x minikube
eof


# ./minikube start VM_DRIVER=hyperkit
# ./minikube status
# ./minikube dashboard
# kubectl version
# kubectl proxy --address='0.0.0.0' --disable-filter=true
# kubectl get nodes
